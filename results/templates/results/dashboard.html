{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Results</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');
        .scrollbar-thin::-webkit-scrollbar { width: 4px; }
        .scrollbar-thin::-webkit-scrollbar-track { background: transparent; }
        .scrollbar-thin::-webkit-scrollbar-thumb { background: #e5e7eb; border-radius: 2px; }
        .quote-wall { columns: 3; column-gap: 0.75rem; }
        .quote-card { break-inside: avoid; margin-bottom: 0.75rem; }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: { dark: '#1A1A1A' },
                    fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] }
                }
            }
        }
    </script>
    <script>const INTERVIEW_ID = '{{ interview.uuid }}';</script>
    <script defer src="{% static 'results/dashboard.js' %}"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="min-h-screen bg-white font-sans">
    {% include "includes/header.html" %}

    <div x-data="resultsApp()" x-init="loadResults()" class="h-[calc(100vh-65px)] flex">

        {% include "results/partials/topic_sidebar.html" %}

        <!-- Right Panel -->
        <div class="flex-1 flex flex-col overflow-hidden">

            <!-- Main view (non-chat) -->
            <div x-show="!chatOpen" class="flex-1 flex flex-col overflow-hidden">

                <!-- No Selection -->
                <div x-show="selectedIndex === null" class="flex-1 flex items-center justify-center">
                    <p class="text-gray-400">Select a topic to view details</p>
                </div>

                <!-- Selected topic -->
                <template x-if="selectedIndex !== null && results[selectedIndex]">
                    <div class="flex-1 flex flex-col overflow-hidden">

                        <!-- Results & failed state: single-column view -->
                        <div x-show="!isEditor()" class="flex-1 overflow-y-auto scrollbar-thin">
                            <div class="p-8">
                                {% include "results/partials/topic_header.html" %}
                                {% include "results/partials/failed_state.html" %}
                                {% include "results/partials/results_view.html" %}
                            </div>
                            {% include "results/partials/answer_wall.html" %}
                        </div>

                        <!-- Theme editor -->
                        <div x-show="isEditor()" class="flex-1 overflow-y-auto scrollbar-thin">
                            {% include "results/partials/editor.html" %}
                            {% include "results/partials/answer_wall.html" %}
                        </div>

                    </div>
                </template>
            </div>

            {% include "results/partials/chat_panel.html" %}
        </div>

        <!-- Floating Chat Button -->
        <button
            @click="chatOpen = true"
            x-show="!chatOpen"
            class="fixed bottom-6 right-6 w-14 h-14 rounded-full shadow-lg flex items-center justify-center text-white bg-gray-900 hover:bg-gray-800 transition-all duration-200 hover:scale-105 z-50"
        >
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
            </svg>
        </button>

    </div>
</body>
</html>
